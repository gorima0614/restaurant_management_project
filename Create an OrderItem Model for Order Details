from django.db import models
from home.models import MenuItem  # Import your MenuItem model from the home app
from django.core.validators import MinValueValidator

# Assuming you already have an Order model defined somewhere in this file or another related file
# Example:
# class Order(models.Model):
#     customer = models.ForeignKey(User, on_delete=models.CASCADE)
#     created_at = models.DateTimeField(auto_now_add=True)
#     total_price = models.DecimalField(max_digits=10, decimal_places=2, default=0.00)
#     status = models.CharField(max_length=20, default='Pending')
#
#     def __str__(self):
#         return f"Order #{self.id} by {self.customer.username}"

class OrderItem(models.Model):
    """
    Represents an individual item within a customer's order.
    Each OrderItem links to one specific Order and one specific MenuItem.
    """
    # Link to the Order model
    order = models.ForeignKey(
        'Order',                        # Refers to the Order model
        on_delete=models.CASCADE,        # Delete OrderItems when the parent Order is deleted
        related_name='order_items'       # Allows reverse access: order.order_items.all()
    )

    # Link to the MenuItem model (from home/models.py)
    menu_item = models.ForeignKey(
        MenuItem,
        on_delete=models.CASCADE,        # If a MenuItem is deleted, its related OrderItems are removed
        related_name='order_items'
    )

    # Quantity ordered
    quantity = models.IntegerField(
        default=1,
        validators=[MinValueValidator(1)]  # Ensures quantity cannot be less than 1
    )

    # Price of the menu item at the time of order (important if menu prices change later)
    price_at_time_of_order = models.DecimalField(
        max_digits=8,
        decimal_places=2
    )

    def __str__(self):
        return f"{self.quantity} x {self.menu_item.name}"

Make and Apply Migrations
Run these commands in your terminal:
python manage.py makemigrations orders
python manage.py migrate

orders/admin.py

from django.contrib import admin
from .models import OrderItem
@admin.register(OrderItem)
class OrderItemAdmin(admin.ModelAdmin):
    list_display = ('id', 'order', 'menu_item', 'quantity', 'price_at_time_of_order')
    list_filter = ('menu_item',)
    search_fields = ('menu_item__name', 'order__id')

Example Usage in Code
from home.models import MenuItem
from orders.models import Order, OrderItem
# Example: Create a new order and add items
order = Order.objects.create(customer=request.user)
menu_item = MenuItem.objects.get(id=1)
order_item = OrderItem.objects.create(
    order=order,
    menu_item=menu_item,
    quantity=2,
    price_at_time_of_order=menu_item.price
)
